{% comment %}
  ==={{ search.performed }}===
  <br>
  <br>
  {{ pros.size }}
  <br>
{% endcomment %}

<div class="container">
  <section class="filter-applied-on">
  <div class="search-in">
    <form action="{{ routes.search_url }}">
      <input
        type="text"
        placeholder="Search"
        name="q"
        value="{{ search.terms | escape }}"
      >
      <input type="hidden" name="type" value="product,page,article">
      <input type="hidden" name="options[unavailable_products]" value="hide">
      <input type="hidden" name="options[prefix]" value="last">
      <button type="submit" value="Search">{{ 'search.search' | t }}</button>
    </form>
  </div>
  <br>
  <br>
  <br>

  {% assign limit = section.settings.limit %}

  {% if search.performed %}
    {% if search.results_count > 0 %}
      {% paginate search.results by limit %}
        {% assign pros_array = search.results | where: 'object_type', 'product' %}
        {% assign pagesArray = search.results | where: 'object_type', 'page' %}
        {% assign artyArray = search.results | where: 'object_type', 'article' %}

        {% if pros_array.size > 0 %}
          {% render 'facets', results: search, enable_filtering: true, enable_sorting: true, paginate: paginate %}
          <h4>{{ 'search.products' | t }}</h4>
          <div class="product-row pro-grid-wrapper">
            {% for item in search.results %}
              {% case item.object_type %}
                {% when 'product' %}
                  {% render 'product', product: item %}
              {% endcase %}
            {% endfor %}
          </div>
        {% endif %}
        <br>
        <br>
        <br>
        {% if pagesArray.size > 0 %}
          <h4>
            <u>
              {{ 'search.pages' | t }}
              {{ pagesArray.size }}
            </u>
          </h4>
          {% for item in search.results %}
            {% case item.object_type %}
              {% when 'page' %}
                <a id="{{ item.id }}" class="article-template__comments-comment each-comment" href="{{ item.url }}">
                  <!-- <h4>Page</h4> -->
                  <h4>{{ item.title }}</h4>
                  <footer-c class="comment-meta">
                    <span class="caption-with-letter-spacing">
                      {{ 'article.published' | t }}:
                      {{- item.published_at | time_tag: format: 'date' -}}
                    </span>
                  </footer-c>
                </a>
                {% comment %}
                {% endcomment %}
            {% endcase %}
          {% endfor %}
        {% endif %}
        <br>
        <br>
        <br>

        {% if artyArray.size > 0 %}
          <h4>{{ 'search.articles' | t }}</h4>
          <div class="articles">
            {% for item in search.results %}
              {% case item.object_type %}
                {% when 'article' %}
                  {% render 'article-card', article: item %}
              {% endcase %}
            {% endfor %}
          </div>
        {% endif %}

        {%- if paginate.pages > 1 -%}
          {% render 'pagination', paginate: paginate, anchor: '' %}
        {%- endif -%}
      {% endpaginate %}

    {% else %}
      <div>
        {% render 'message', message: 'No Results Found' %}
      </div>
    {% endif %}

  {% else %}

  {% endif %}
  </section>
</div>

{% schema %}
{
  "name": "Main Search",
  "settings": [
    {
      "type": "range",
      "id": "limit",
      "label": "Results Per Page",
      "min": 10,
      "default": 25,
      "max": 100,
      "step": 5
    }
  ]
}
{% endschema %}

{% stylesheet %}
  
{% endstylesheet %}

{% javascript %}

 const facetForm = document.getElementById('FacetFiltersForm')
    facetForm.addEventListener('change', function(e){
      e.preventDefault();
      let formData = new FormData(facetForm);
      let data = {};
      let query = "";
      formData.forEach((value, key) => {
          console.log()
          data[key] = value;
          query += ("&" + key  + "=" + value)
      });
      let q2 = query.replace("&", "?")
      applyFilter(q2);
    })

{% endjavascript %}
