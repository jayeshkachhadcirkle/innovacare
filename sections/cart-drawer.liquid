{{ 'cart-drawer.css' | asset_url | stylesheet_tag }}

{% assign all_discounted = 'true' %}
{% for i in cart.items %}
  {% if i.variant.compare_at_price == blank %}
    {% assign all_discounted = 'false' %}
  {% endif %}
{% endfor %}

{% assign all_subs = 'true' %}
{% for i in cart.items %}
  {% if i.selling_plan_allocation.selling_plan.name == blank %}
    {% assign all_subs = 'false' %}
  {% endif %}
{% endfor %}

<div
  class="mini-cart"
  id="mini-cart"
  data-shipping-charge="{{ settings.shipping_charge }}"
  data-shipping-charge-pro="{{ settings.shipping_charge_pro.first_available_variant.id }}"
  data-auto-charge="{{ settings.shipping_auto }}"
>
  <div class="overlay" id="cart_overlay"></div>
  <div class="mini_cart_wp">
    <div class="mini_cart_main" id="mini_cart_main">
      {% if cart.item_count > 0 %}
        <div
          class="mini_cart_title"
          data-in-cart-vars="0,{% for i in cart.items %}{{ i.variant_id }}{% if forloop.last %}{% else %},{% endif %}{% endfor %}"
        >
          <div class="mini-cart_heding text-center">
            <h4>{{ 'cart.general.basket' | t }}</h4>
          </div>
        </div>

        <form
          action="{{ routes.cart_url }}"
          id="Cart-DrawerForm"
          class="cart__contents cart-drawer__form"
          method="post"
        >
          <div
            class="mini_cart_body"
            count="{{ cart.item_count }}"
            total="{{ cart.total_price }}"
          >
            <div class="mini_cart_body_inner">
              {% for item in cart.items %}
                <div
                  class="mini_cart_item all-items-cart"
                  collection="{% for collection in item.product.collections %}{{ collection.handle }},{% endfor %}"
                >
                  <div class="mini_cart_card flex ">
                    <div class="mini_cart_product">
                      <a href="{{ item.product.url }}" class="cart_product_media">
                        {% if item.image != blank %}
                          {{ item.image | img_url | img_tag: item.product.title }}
                        {% else %}
                          {{ 'placer.svg' | inline_asset_content }}
                        {% endif %}
                      </a>
                    </div>
                    <div class="cart_product_details">
                      <div class="cart_product_details-top flex justify-between">
                        <div class="cart_product_info">
                          <h5>
                            {{ item.title | link_to: item.product.url -}}
                            {%- if item.properties._instruction.size > 0 -%}
                              -({{ item.properties._instruction }})
                            {%- endif %}
                          </h5>
                        </div>
                        <div class="product_price">
                          <span>{{ item.price | money }}</span>
                          <span
                            ><del>{{ item.variant.compare_at_price | money }}</del></span
                          >
                        </div>
                      </div>
                      <p style="color: blue; font-size: small;">
                        {% if item.selling_plan_allocation.selling_plan.name != blank %}
                          ( {{ item.selling_plan_allocation.selling_plan.name }} )
                        {% endif %}
                      </p>
                      <cart-qty-manager item-key="{{ item.key }}" variant="{{ item.variant_id }}">
                        <div class="cart_product_details-bottom">
                          <div class="pd_bottom_inner wrep">
                            <div
                              class="cart-qntty-col"
                              data-id="{{ item.key }}"
                              data-variant="{{ item.variant_id }}"
                            >
                              <div
                                class="qtyAdjust {% if item.variant_id == settings.offer_product.first_available_variant.id %} hidden {% endif %}"
                                bundled="{{ item.properties['_isRecommended'] }}"
                                bundleId="{{ item.properties['_bundleId'] }}"
                              >
                                <input
                                  type="number"
                                  min="01"
                                  value="{{ item.quantity }}"
                                  variant="{{ item.variant_id }}"
                                  item-key="{{ item.key }}"
                                  name="updates[]"
                                  class="tc item-quantity get-qty-dr"
                                  data-discounted="{% if item.variant.price < item.variant.compare_at_price %}true{% else %}false{% endif %}"
                                  data-index="{{ forloop.index }}"
                                >
                                <button
                                  type="submit"
                                  class="adjust dr-minus drawer nostyle-bt"
                                  name="minus"
                                >
                                  {% render 'icons', icon_type: 'minus' %}
                                </button>
                                <button
                                  type="submit"
                                  class="adjust dr-plus drawer nostyle-bt"
                                  name="plus"
                                >
                                  {% render 'icons', icon_type: 'plus' %}
                                </button>
                              </div>
                            </div>
                            <div class="cart-price-col">
                              <div
                                class="item-remove-btn-dr remove-btn"
                                handle="{{ item.product.handle }}"
                                product="{{ item.product.id }}"
                              >
                                {% render 'icons', icon_type: 'delete_btn' %}
                              </div>
                            </div>
                            <div class="qty-error"></div>
                          </div>
                        </div>
                      </cart-qty-manager>
                    </div>
                  </div>
                </div>
              {% endfor %}
            </div>
          </div>
        </form>

        {% capture reco_stopped %}{% for i in settings.stop_recos %}{{ i.id }}{% if forloop.last %}{% else %},{% endif %}{% endfor %}{% endcapture %}
        {% capture reco_pros %}{% for i in cart.items %}{% if reco_stopped contains i.product_id %}{% else %}{{ i.product_id }}{% if forloop.last %}{% else %},{% endif %}{% endif %}{% endfor %}{% endcapture %}
        {% assign reco_pro_sort = reco_pros | split: ',' %}
        {% assign final_reco_product = reco_pro_sort.first %}

        {% render 'cart-recommendation', product_id: final_reco_product, limit: 10, frm: 'drawer' %}

        <div class="mini_cart_footer">
          {% comment %}  {% endcomment %}
          <div class="subscribe-options" style="display: flex;">
            <label style="width: 125px;">
              {% if all_discounted == 'true' %}
                Already Getting Max Discount Click To subscribe
              {% else %}
                Autoship this order and save 10%
              {%- endif %}
            </label>
            <label class="switchShip">
              <input
                type="checkbox"
                id="subscribe-toggle"
                all-subs="{{ all_subs }}"
                class="shipping-plus"
              >
              <span class="sliderShip round"></span>
            </label>
            <select
              name="sub_select"
              id="sub_select"
              class="sub_select"
            >
              <option value="">Select Frequancy</option>
              <option value="1920139402,1920303242">Every 2 week</option>
              <option value="1920172170,1920336010">Every 1 Month</option>
              <option value="1920204938,1920368778">Every 2 Month</option>
            </select>
          </div>
          {% comment %}
            {% if cart.original_total_price > 100000 %}
            {% endif %}
          {% endcomment %}

          <div class="mini_cart_total_wp">
            <div class="mini_cart_total flex align-center justify-between">
              <p>Secure Shipping With Just 5$</p>

              {% if settings.shipping_charge %}
                <label class="switchShip">
                  {% capture cart_vars %}{% for var in cart.items %}{{ var.variant_id }},{% endfor %}{% endcapture %}
                  <input
                    type="checkbox"
                    id="shipping-plus"
                    class="shipping-plus"
                    data-pro="{{ settings.shipping_charge_pro.first_available_variant.id }}"
                    {% if cart_vars contains settings.shipping_charge_pro.first_available_variant.id %}
                      checked
                    {% endif %}
                  >
                  <span class="sliderShip round"></span>
                </label>
              {% endif %}
            </div>
            <div class="mini_cart_total flex align-center justify-between">
              <h5>{{ 'cart.general.cart_summary' | t }}</h5>
              <span
                >Subtotal:
                <span id="cart-subtotal-dr" data-total="{{ cart.original_total_price }}">
                  {{ cart.total_price | money -}}
                </span>
              </span>
            </div>
          </div>
          <div class="mini_cart_order">
            <div class="mini_cart_payment">
              <a
                href="/checkout"
                class="cart_payment checkout-bt-dr"
                all-subs="{{ all_subs }}"
                alldiscounted="{{ all_discounted }}"
              >
                {{ 'cart.general.checkout' | t }}
              </a>
            </div>
            <div class="mini_cart_payment">
              <a href="{{ routes.cart_clear_url }}" class="cart_payment empty-cart-bt">
                {{ 'cart.general.clear' | t }}
              </a>
            </div>
          </div>
        </div>

        {% comment %} create a confirmation popup div for subscribed {% endcomment %}

        <duv class="popup-subscribe-confirmation" id="popup-subscribe-confirmation">
          <div class="popup-subscribe-confirmation-inner">
            <div class="popup-subscribe-confirmation-content">
              {% comment %} <span class="close-popup-subscribe-confirmation" id="close-popup-subscribe-confirmation">&times;</span> {% endcomment %}
              <h3>Did not subscribed Yet get 10% Off</h3>
              <p>.............................</p>
              <div class="popup-buttons">
                <button
                  class="btn-primary"
                  id="close-popup-subscribe-confirmation-btn"
                  onclick='applySellingPlanToCart("1920172170,1920336010")'
                >
                  Subscribe
                </button>
                <button class="btn-primary" id="close-popup-subscribe-confirmation-btn">
                  <a href="/checkout">Skip</a>
                </button>
              </div>
            </div>
          </div>
        </duv>
        <style>
          .popup-subscribe-confirmation {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 70%;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
          }
          .popup-buttons {
            display: flex;
            justify-content: space-around;
            gap: 20px;
            margin-top: 20px;
          }
          .popup-subscribe-confirmation-inner {
            background-color: #fff;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 400px;
            text-align: center;
            border-radius: 10px;
          }

          .close-popup-subscribe-confirmation {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
          }

          .close-popup-subscribe-confirmation:hover,
          .close-popup-subscribe-confirmation:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
          }
        </style>

        <div class="cart_colse_icon" id="cart_colse_icon">
          {% render 'icons', icon_type: 'cart_close' %}
        </div>
      {% else %}
        <div
          class="mini_cart_title"
          data-in-cart-vars="0,{% for i in cart.items %}{{ i.variant_id }}{% if forloop.last %}{% else %},{% endif %}{% endfor %}"
        >
          <div class="mini-cart_heding text-center">
            <h4>{{ 'cart.general.basket' | t }}</h4>
            .........................................
          </div>
        </div>
        <div class="mini_cart_body">
          <div class="mini_cart_body_inner">
            <div class="empty_cart">
              <h4>{{ 'cart.general.empty' | t }}</h4>
              <a href="{% if section.settings.continue_btn != blank %}{{ section.settings.continue_btn }} {% else %} {{ routes.all_products_collection_url }}{% endif %} ">
                <button class="btn-primary">{{ 'cart.general.continue_shopping' | t }}</button>
              </a>
            </div>
            <p>
              {{ 'cart.general.have_account' | t }}
              <a style="color: var(--red);" href="{{ routes.account_login_url }}">{{ 'cart.general.login' | t }}</a>
            </p>
            <p>or</p>
            <p>
              {{ 'cart.general.create_account' | t }}
              <a style="color: var(--red);" href="{{ routes.account_register_url }}">{{ 'cart.general.signup' | t }}</a>
            </p>
          </div>
        </div>
        <div class="cart_colse_icon" id="cart_colse_icon">
          {% render 'icons', icon_type: 'cart_close' %}
        </div>
      {% endif %}
    </div>

    {% render 'free-shipping-bar' %}
  </div>
</div>

{% javascript %}
  document.querySelectorAll('.get-qty-dr').forEach(function (e) {
    e.addEventListener('click', function (event) {
      event.preventDefault();
    });
  });
{% endjavascript %}

{% schema %}
{
  "name": "Cart drawer",
  "settings": [
    {
      "type": "url",
      "label": "Continue To",
      "id": "continue_btn"
    }
  ]
}
{% endschema %}
